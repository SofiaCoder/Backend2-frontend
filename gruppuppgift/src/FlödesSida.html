<!DOCTYPE html>
<html>
  <head>
    <title>Flödessida</title>
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="script.js"></script>
  </head>
  <body>
    <header>
      <h1>Flödessida</h1>
      <ul class="nav">
        <li><a href="#post-list">Flöde</a></li>
        <li><a href="#search-friends">Sök vänner</a></li>
      </ul>
    </header>
    <main>
      <section id="post-list">
        <h2>Flöde</h2>
        <ul></ul>
        <form id="post-form">
          <label for="post-text">Skriv ett inlägg:</label>
          <textarea name="post-text" id="post-text"></textarea>
          <input type="submit" value="Posta" />
        </form>
      </section>

      <section id="search-friends">
        <h2>Sök vänner</h2>
        <form>
          <label for="friend-name">Namn:</label>
          <input type="text" name="friend-name" id="friend-name" />
          <input type="submit" value="Sök" />
        </form>
        <ul></ul>
      </section>
    </main>

    <footer>
      <p>Flödessida &copy; 2023</p>
    </footer>

    <script>
        // Hämta inlägg från databasen och visa dem på sidan
        $.get("/posts", function (posts) {
          posts.forEach(function (post) {
            showPost(post);
          });
        });

        // Skicka en AJAX-begäran till servern för att lägga till ett nytt inlägg i databasen när formuläret skickas
        $("#post-form").submit(function (event) {
          event.preventDefault();

          var postText = $("#post-text").val();

          $.post("/posts", { text: postText }, function (post) {
            showPost(post);
          });

          // Rensa textfältet efter att inlägget har lagts till i databasen
          $("#post-text").val("");
        });

        // Sök efter vänner när formuläret skickas
        $("form").submit(function (event) {
          event.preventDefault();

          var friendName = $("#friend-name").val();

          // Skicka en AJAX-begäran till servern för att söka efter vänner i databasen
          $.get("/friends", { friendName: friendName }, function (friends) {
            var friendList = $("#search-friends ul");

            // Visa sökresultaten på sidan
            friendList.empty();
            friends.forEach(function (friend) {
              var friendElement = $("<li>").addClass("friend");
              var friendLink = $("<a>").attr("href", "#").text(friend.name);

              friendLink.click(function () {
                // Skicka en AJAX-begäran till servern för att hämta vänns inlägg från
                $.get("/friends/" + friend.id + "/posts", function (posts) {
                  $("#post-list ul").empty();
                  posts.forEach(function (post) {
                    showPost(post);
                  });
                     // Uppdatera rubriken för flödet
            $("#post-list h2").text("Inlägg från " + friend.name);

      // Göm sökresultaten för vänner och visa flödet
      $("#search-friends").hide();
      $("#post-list").show();
      });

      friendElement.append(friendLink);
      friendList.append(friendElement);
      });

      // Visa sökresultaten på sidan
      $("#search-friends").show();
      $("#post-list").hide();
      });
      });

      // Visa ett inlägg på sidan
      function showPost(post) {
      var postElement = $("<li>").addClass("post");
      var postText = $("<div>").addClass("post-text").text(post.text);
      var postAuthor = $("<div>").addClass("post-author").text("Skapad av " + post.author);
      var postDate = $("<div>").addClass("post-date").text(new Date(post.timestamp).toLocaleString());

      postElement.append(postText);
      postElement.append(postAuthor);
      postElement.append(postDate);

      $("#post-list ul").prepend(postElement);
      }
    </script>
  </body>
</html>
